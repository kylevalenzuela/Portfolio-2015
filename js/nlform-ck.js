/**
 * nlform.js v1.0.0
 * http://www.codrops.com
 *
 * Licensed under the MIT license.
 * http://www.opensource.org/licenses/mit-license.php
 * 
 * Copyright 2013, Codrops
 * http://www.codrops.com
 */(function(e){"use strict";function n(e){this.el=e;this.overlay=this.el.querySelector(".nl-overlay");this.fields=[];this.fldOpen=-1;this._init()}function r(e,t,n,r){this.form=e;this.elOriginal=t;this.pos=r;this.type=n;this._create();this._initEvents()}var t=e.document;String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});n.prototype={_init:function(){var e=this;Array.prototype.slice.call(this.el.querySelectorAll("select")).forEach(function(t,n){e.fldOpen++;e.fields.push(new r(e,t,"dropdown",e.fldOpen))});Array.prototype.slice.call(this.el.querySelectorAll("input")).forEach(function(t,n){e.fldOpen++;e.fields.push(new r(e,t,"input",e.fldOpen))});this.overlay.addEventListener("click",function(t){e._closeFlds()});this.overlay.addEventListener("touchstart",function(t){e._closeFlds()})},_closeFlds:function(){this.fldOpen!==-1&&this.fields[this.fldOpen].close()}};r.prototype={_create:function(){this.type==="dropdown"?this._createDropDown():this.type==="input"&&this._createInput()},_createDropDown:function(){var e=this;this.fld=t.createElement("div");this.fld.className="nl-field nl-dd";this.toggle=t.createElement("a");this.toggle.innerHTML=this.elOriginal.options[this.elOriginal.selectedIndex].innerHTML;this.toggle.className="nl-field-toggle";this.optionsList=t.createElement("ul");var n="";Array.prototype.slice.call(this.elOriginal.querySelectorAll("option")).forEach(function(t,r){n+=e.elOriginal.selectedIndex===r?'<li class="nl-dd-checked">'+t.innerHTML+"</li>":"<li>"+t.innerHTML+"</li>";e.elOriginal.selectedIndex===r&&(e.selectedIdx=r)});this.optionsList.innerHTML=n;this.fld.appendChild(this.toggle);this.fld.appendChild(this.optionsList);this.elOriginal.parentNode.insertBefore(this.fld,this.elOriginal);this.elOriginal.style.display="none"},_createInput:function(){var e=this;this.fld=t.createElement("div");this.fld.className="nl-field nl-ti-text";this.toggle=t.createElement("a");this.toggle.innerHTML=this.elOriginal.getAttribute("placeholder");this.toggle.className="nl-field-toggle";this.optionsList=t.createElement("ul");this.getinput=t.createElement("input");this.getinput.setAttribute("type","text");this.getinput.setAttribute("placeholder",this.elOriginal.getAttribute("placeholder"));this.getinputWrapper=t.createElement("li");this.getinputWrapper.className="nl-ti-input";this.inputsubmit=t.createElement("button");this.inputsubmit.className="nl-field-go";this.inputsubmit.innerHTML="";this.getinputWrapper.appendChild(this.getinput);this.getinputWrapper.appendChild(this.inputsubmit);this.example=t.createElement("li");this.example.className="nl-ti-example";this.example.innerHTML=this.elOriginal.getAttribute("data-subline");this.optionsList.appendChild(this.getinputWrapper);this.optionsList.appendChild(this.example);this.fld.appendChild(this.toggle);this.fld.appendChild(this.optionsList);this.elOriginal.parentNode.insertBefore(this.fld,this.elOriginal);this.elOriginal.style.display="none"},_initEvents:function(){var e=this;this.toggle.addEventListener("click",function(t){t.preventDefault();t.stopPropagation();e._open()});this.toggle.addEventListener("touchstart",function(t){t.preventDefault();t.stopPropagation();e._open()});if(this.type==="dropdown"){var t=Array.prototype.slice.call(this.optionsList.querySelectorAll("li"));t.forEach(function(n,r){n.addEventListener("click",function(r){r.preventDefault();e.close(n,t.indexOf(n))});n.addEventListener("touchstart",function(r){r.preventDefault();e.close(n,t.indexOf(n))})})}else if(this.type==="input"){this.getinput.addEventListener("keydown",function(t){t.keyCode==13&&e.close()});this.inputsubmit.addEventListener("click",function(t){t.preventDefault();e.close()});this.inputsubmit.addEventListener("touchstart",function(t){t.preventDefault();e.close()})}},_open:function(){if(this.open)return!1;this.open=!0;this.form.fldOpen=this.pos;var e=this;this.fld.className+=" nl-field-open"},close:function(e,t){if(!this.open)return!1;this.open=!1;this.form.fldOpen=-1;this.fld.className=this.fld.className.replace(/\b nl-field-open\b/,"");if(this.type==="dropdown"){if(e){var n=this.optionsList.children[this.selectedIdx];n.className="";e.className="nl-dd-checked";this.toggle.innerHTML=e.innerHTML;this.selectedIdx=t;this.elOriginal.value=this.elOriginal.children[this.selectedIdx].value}}else if(this.type==="input"){this.getinput.blur();this.toggle.innerHTML=this.getinput.value.trim()!==""?this.getinput.value:this.getinput.getAttribute("placeholder");this.elOriginal.value=this.getinput.value}}};e.NLForm=n})(window);